use Campus_Eats_Fall2020;
drop table if exists driver_ratings;
drop table if exists restaurant_ratings;
create table driver_ratings(
rating_id int not null primary key,
order_id int not null,
restaurant_id int not null,
location_id int not null,
driver_id int not null,
vehicle_id int not null,
delivery_time datetime,
tip_amount numeric,
order_amount numeric,
delivery_fee numeric,
rating numeric CONSTRAINT positive_rating CHECK (rating between 1 and 5),
FOREIGN KEY (order_id) REFERENCES `Order`(order_id),
FOREIGN KEY (restaurant_id) REFERENCES restaurant(restaurant_id),
FOREIGN KEY (location_id) REFERENCES location(location_id),
FOREIGN KEY (driver_id) REFERENCES driver(driver_id),
FOREIGN KEY (vehicle_id) REFERENCES vehicle(vehicle_id)
);

alter table driver_ratings
drop column rating_id;

alter table driver_ratings
add column rating_id serial primary key;

INSERT INTO `driver_ratings` (`order_id`,`restaurant_id`,`location_id`,`driver_id`,`vehicle_id`,`delivery_time`,`tip_amount`,`order_amount`,`delivery_fee`,`rating`) VALUES (101,10,98,5,2,"2020-04-26 14:02:23","5.4862401167","20.8622674031","5","2.5068775003"),(28,62,89,5,3,"2020-05-13 06:04:51","4.3720500563","22.2382248356","5","2.377559652"),(39,31,4,5,3,"2020-05-02 18:01:29","5.386279676","23.7836470005","5","2.5710978513"),(64,1,13,1,10,"2020-05-31 23:56:55","4.8132317678","23.5629954104","5","2.6433032645"),(20,81,25,1,8,"2020-03-25 04:11:47","4.7446999995","24.6053175231","5","1.8878280028"),(8,51,54,3,7,"2020-03-30 10:57:46","5.0295219783","22.0736322464","5","2.6953860304"),(69,97,44,5,5,"2020-07-21 16:48:19","5.2054200664","18.3715974386","5","2.5362732653"),(98,78,55,5,3,"2020-05-07 11:24:25","5.7363841078","20.1782410268","5","2.4074517081"),(32,5,7,4,9,"2020-07-24 08:41:08","5.1680090027","28.2651448503","5","2.5754526118"),(42,43,10,3,10,"2020-06-08 11:56:25","5.4467563756","33.6549425815","5","2.7698689211"),(41,74,23,3,7,"2020-04-05 15:29:14","4.8892864719","22.0460936455","5","2.9273162199"),(19,57,8,8,4,"2020-05-19 21:26:48","5.4502105601","30.801019565","5","2.6422401561"),(3,79,52,5,8,"2020-05-14 20:37:59","4.9488714555","20.5332800009","5","3.0083586396"),(44,94,66,4,9,"2020-04-13 02:30:07","5.4307564999","25.1116516226","5","2.300929317"),(64,74,40,1,7,"2020-06-24 18:44:25","4.9885976748","27.6510934483","5","2.2612933016"),(87,16,6,5,6,"2020-04-09 12:31:29","5.7320225238","24.1728657158","5","2.5547540799"),(10,25,22,4,1,"2020-05-03 16:06:07","5.8630924231","27.3659306753","5","2.3077010351"),(100,3,35,5,5,"2020-07-26 23:41:44","5.0966657403","22.1867769723","5","2.358761116"),(4,65,45,2,3,"2020-03-26 01:57:18","4.3638243831","25.2316248511","5","2.1164728426"),(42,61,39,1,6,"2020-07-08 02:15:43","5.4300661932","23.0020046019","5","2.6339007569"),(52,57,22,4,8,"2020-04-01 12:00:51","5.5872543444","28.5228698624","5","2.1742417736"),(82,49,23,7,8,"2020-05-08 15:54:39","5.6585330351","23.9090438546","5","2.853411631"),(98,23,74,8,6,"2020-04-04 14:57:38","5.3301552321","25.7981609319","5","2.3794292406"),(81,71,26,3,2,"2020-06-13 21:45:45","5.0043527511","21.966124441","5","2.8360259116"),(31,59,45,4,6,"2020-03-28 13:45:04","4.3216924087","26.9536673316","5","2.4782686785"),(61,27,40,1,9,"2020-04-12 23:34:52","5.3969343799","20.1448451181","5","2.5887640261"),(52,79,20,3,4,"2020-06-02 13:30:55","4.8834544527","27.4067169089","5","2.5517937887"),(80,15,41,3,9,"2020-05-10 09:13:59","4.5286228257","26.1367723418","5","2.8049436391"),(5,88,6,8,2,"2020-04-17 12:50:19","5.3085191974","25.9298558829","5","2.8633029571"),(38,36,96,5,5,"2020-04-06 04:12:39","3.9257896674","25.7171597094","5","2.9287731107"),(1,100,68,5,1,"2020-04-10 20:29:16","5.2471967413","22.0946976177","5","2.3575559249"),(96,37,36,7,6,"2020-05-28 06:53:36","4.6071454624","29.843746575","5","2.1471715325"),(21,92,50,3,6,"2020-04-06 00:44:05","5.5697798073","29.3983183033","5","2.0802920836"),(68,94,82,7,2,"2020-04-30 09:37:56","5.1379446162","21.5796651067","5","2.4309887263"),(55,56,26,3,10,"2020-05-13 11:33:25","5.1429045897","22.0165001154","5","2.168221999"),(39,59,49,7,7,"2020-07-03 06:04:33","4.9110436684","21.0381095571","5","2.1011207761"),(39,47,40,6,1,"2020-05-21 18:28:53","5.3417426592","22.5377391053","5","2.9384107923"),(87,38,69,3,8,"2020-07-24 07:30:34","4.9072595598","21.2993979004","5","2.1974841299"),(92,58,72,6,4,"2020-07-03 09:59:51","4.3892686889","24.7007148084","5","2.1440942103"),(98,55,16,7,4,"2020-05-01 21:13:03","4.368619924","24.8621271446","5","2.7602673061"),(46,64,29,8,7,"2020-05-19 03:56:46","4.4838307844","29.5544113256","5","2.6192370438"),(85,41,59,1,9,"2020-07-23 01:41:42","5.3083594201","26.7986150067","5","2.2912165013"),(76,65,26,4,2,"2020-05-30 16:38:22","5.9382949823","25.9265176848","5","2.2371852589"),(83,73,5,1,6,"2020-05-08 23:33:10","5.2391706995","24.249656881","5","2.0328914251"),(100,18,77,7,1,"2020-04-30 09:51:04","5.0116456863","18.6900615597","5","2.7417904164"),(35,38,90,3,1,"2020-07-28 00:02:16","4.5438763063","20.0078633525","5","2.4454962611"),(11,7,68,6,5,"2020-05-16 11:13:33","5.5045215385","29.2176876981","5","2.4662257212"),(20,61,100,4,8,"2020-06-21 02:12:40","4.5985075732","21.9538548464","5","2.6236150314"),(56,70,19,4,7,"2020-06-04 00:49:30","4.9705902873","30.9944915312","5","2.6016876902"),(85,10,16,1,5,"2020-07-01 17:12:13","4.894172936","26.6114237165","5","2.0467468587");

create table restaurant_ratings(
rating_id serial primary key,
order_id int not null,
restaurant_id int not null,
delivery_time datetime,
order_amount numeric,
rating numeric constraint positive_rating_2 check (rating between 1 and 5),
FOREIGN KEY (order_id) REFERENCES `Order`(order_id),
FOREIGN KEY (restaurant_id) REFERENCES restaurant(restaurant_id)
);

INSERT INTO `restaurant_ratings` (`order_id`,`restaurant_id`,`delivery_time`,`order_amount`,`rating`) VALUES (101,55,"2020-07-05 14:28:40","28.3456044829","2.473422167"),(95,7,"2020-06-18 07:05:22","29.6602623435","2.7845453667"),(2,31,"2020-05-23 19:21:02","18.468440552","2.478673282"),(99,65,"2020-06-09 18:47:02","29.8752520849","2.3576243894"),(44,64,"2020-06-22 21:13:47","24.9758833807","2.8459106853"),(18,38,"2020-06-16 03:15:50","18.7589639562","2.31750908"),(76,98,"2020-06-09 21:22:43","20.4666308747","2.3995595126"),(47,58,"2020-07-06 12:58:26","26.6302875102","2.7098771049"),(85,14,"2020-05-19 13:37:35","29.3195204958","2.7595435456"),(29,94,"2020-04-30 00:10:24","25.7662581151","2.2616443138"),(81,56,"2020-04-09 23:12:08","22.4201683147","2.5822775148"),(67,44,"2020-06-25 01:03:56","24.9195743881","2.3674975128"),(46,3,"2020-05-05 20:34:53","22.459162953","2.2791536098"),(66,52,"2020-06-11 03:47:27","28.1256471451","2.4021663125"),(85,8,"2020-05-27 00:35:31","23.2626428416","2.3844287228"),(40,81,"2020-05-12 23:39:44","19.3874626964","2.6005376761"),(32,31,"2020-07-02 01:05:02","30.3488928314","2.4911321863"),(65,44,"2020-04-09 02:20:24","23.2542350785","2.2921509923"),(37,94,"2020-07-22 10:45:21","29.866116973","2.6642570038"),(25,16,"2020-04-28 08:17:05","27.7196756039","2.8159873872"),(33,57,"2020-07-07 18:33:07","24.044933502","2.5627936753"),(16,49,"2020-06-16 14:59:02","24.3090858703","2.493047264"),(53,15,"2020-06-22 16:30:43","19.8107015118","2.3336847596"),(97,49,"2020-05-04 00:50:41","24.7781587903","2.7389820865"),(19,37,"2020-06-26 13:57:17","21.9223949815","2.7134596515"),(22,94,"2020-06-16 22:25:53","23.8562851265","2.2346384939"),(64,51,"2020-05-27 10:53:53","27.7407895486","2.534836891"),(45,21,"2020-06-03 03:34:43","22.2147419569","2.5444647737"),(7,56,"2020-07-29 11:01:39","21.3414119598","2.3712330422"),(4,49,"2020-07-13 05:43:14","23.0858251919","2.139587923"),(55,33,"2020-07-23 19:34:46","23.9117435802","2.7846929806"),(77,4,"2020-07-16 18:44:58","19.5802219279","2.2293676423"),(57,35,"2020-05-18 23:58:00","24.4058415411","2.3849665136"),(23,99,"2020-03-30 13:59:38","28.1877811779","2.6510765775"),(64,32,"2020-05-26 02:32:40","20.0126406763","2.5897163063"),(22,6,"2020-03-30 19:29:42","21.6329572611","2.4830258719"),(5,15,"2020-04-30 05:23:21","26.9586010883","2.3445836225"),(96,19,"2020-04-10 11:46:36","17.170074221","2.2817573351"),(55,61,"2020-05-18 16:32:03","25.555779425","2.8085756534"),(74,96,"2020-07-14 04:44:11","23.0049920256","2.5490084493"),(95,40,"2020-07-17 09:20:23","21.4151959555","2.6988097598"),(38,92,"2020-06-17 08:02:43","30.2945081903","2.6300267512"),(35,68,"2020-05-31 10:02:28","26.2075158395","2.7257299382"),(33,40,"2020-03-27 08:06:36","20.1628126662","2.3424422423"),(21,53,"2020-04-02 02:28:55","26.6866000195","2.7046323291"),(86,51,"2020-06-09 07:47:27","28.529733394","2.4517501858"),(23,79,"2020-07-24 19:39:48","27.6532058822","2.333075402"),(44,98,"2020-03-26 18:46:25","27.4535400581","2.4684964758"),(65,55,"2020-06-10 20:45:21","24.4055076033","2.975772251"),(67,47,"2020-06-25 13:15:44","30.5480963371","2.9359724414");

drop table if exists ratings_master; 
create table ratings_master (
rating_id int primary key,
rating_time datetime); 

alter table driver_ratings
drop rating_id;
alter table driver_ratings
ADD rating_id int; 
alter table driver_ratings
add FOREIGN KEY (rating_id) REFERENCES ratings_master(rating_id);

alter table restaurant_ratings
drop rating_id;
alter table restaurant_ratings
add rating_id int;
alter table restaurant_ratings
ADD FOREIGN KEY (rating_id) REFERENCES ratings_master(rating_id);

create or replace view total_amount AS select SUM(order_amount) from restaurant_ratings;

create view restaurant_max_delivery_time as select location, restaurant_name, schedule, website where restaurant_id IS NOT null; 

